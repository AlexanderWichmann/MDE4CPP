/*-------------------------------------------------
*
* Tasks created by fuml4CPP Generator 
*
*-------------------------------------------------
*/

apply plugin: 'cpp'

description 'C++ project of model NewModel.uml, generated by Fuml4CPP'

File appendDebugSuffix(File binaryFile) {
  int extensionSeparatorIndex = binaryFile.path.lastIndexOf('.')
  return new File(binaryFile.path.substring(0, extensionSeparatorIndex) + "d" + binaryFile.path.substring(extensionSeparatorIndex))
}

task deliverNewModelExec(dependsOn: ['deliverNewModelExecDebugExecutable', 'deliverNewModelExecReleaseExecutable']) {
	description 'deliver NewModelExec header, debug and release executable to application folder (%MDE4CPP_HOME%/application)'
}

task deliverNewModelExecDebugExecutable(type: Copy) {
	description 'deliver NewModelExec debug executable to %MDE4CPP_HOME%/application/bin'
	from "build/exe/NewModelExec/debug"
	into System.getenv('MDE4CPP_HOME')+"/application/bin"
	include "NewModelExecd.exe"
}

task deliverNewModelExecReleaseExecutable(type: Copy) {
	description 'deliver NewModelExec release executable to %MDE4CPP_HOME%/application/bin/release'
	from "build/exe/NewModelExec/release"
	into System.getenv('MDE4CPP_HOME')+"/application/bin"
	include "NewModelExec.exe"
}


model {
    toolChains {
    	 gcc(Gcc) {
    	 	"g++"
    	 }
    }
	
    buildTypes {
        debug 
        release
    }
	repositories {
        libs(PrebuiltLibraries) {
			[ 'ecoreReflection', 'umlReflection' ].each {
				delegate."$it" {
					def libraryName = "${name}"
					headers.srcDir System.getenv('MDE4CPP_HOME')+"/application/include"
					binaries.withType(SharedLibraryBinary) {
						if(buildType == buildTypes.debug) {
							sharedLibraryFile = file(System.getenv('MDE4CPP_HOME')+"/application/bin/${libraryName}d.dll")
						} else {
							sharedLibraryFile = file(System.getenv('MDE4CPP_HOME')+"/application/bin/${libraryName}.dll")						
						}
					}
				}	
			}         
		}
	}

	repositories {
        libs(PrebuiltLibraries) {
			[  'uml', 'ecore', 'fuml', 'primitiveTypesReflection', 'NewModel' ].each {
				delegate."$it" {
					def libraryName = "${name}"
					headers.srcDir System.getenv('MDE4CPP_HOME')+"/application/include/${libraryName}"
					binaries.withType(SharedLibraryBinary) {
						if(buildType == buildTypes.debug) {
							sharedLibraryFile = file(System.getenv('MDE4CPP_HOME')+"/application/bin/${libraryName}d.dll")
						} else {
							sharedLibraryFile = file(System.getenv('MDE4CPP_HOME')+"/application/bin/${libraryName}.dll")						
						}
					}
				}	
			}         
		}
	}

    components {
        NewModelExec(NativeExecutableSpec)
        {
        	sources {
                cpp {
                    source {
                        srcDirs "." 
						include "CheckIfPrimeExecution.cpp"
						include "PrimeCheckerExecution.cpp"
						include "FbDividesExecution.cpp"
						include "FbNextExecution.cpp"
						include "FbPrintIsPrimeExecution.cpp"
						include "FbIsOddExecution.cpp"
						include "FbPrintNotPrimeExecution.cpp"
						include "FbIsNotFinishedExecution.cpp"
						include "main.cpp"
						include	"impl/NewModelFactoryImpl.cpp"
						include	"NewModelFactory.cpp"
						include	"impl/NewModelPackageImpl.cpp"
						include	"NewModelPackage.cpp"
                    }
					exportedHeaders {
                        srcDirs ".", "../", System.getenv('MDE4CPP_HOME')+"/application/include", System.getenv('MDE4CPP_HOME')+"/application/include/Util"
                        include "**/*.hpp"
                    }
									lib library: "uml"
									lib library: "ecore"
									lib library: "fuml"
									lib library: "NewModel"
									lib library: "primitiveTypesReflection"
									lib library: "ecoreReflection"
									lib library: "umlReflection"
				
                }
            }
        }
		
		withType(NativeComponentSpec) {
			binaries.withType(NativeBinarySpec) {
				if (it instanceof NativeExecutableBinarySpec) {
					if(buildType == buildTypes.debug) {
						it.getExecutable().setFile(appendDebugSuffix(it.getExecutable().getFile()))						
					}
				}
			}
        }
    }
    
    binaries {
        all {
        	cppCompiler.args '-std=c++11','-Wall', '-Wno-overloaded-virtual', '-pipe'
			if (buildType == buildTypes.debug) {
				cppCompiler.args '-g'
			}
			else {
				cppCompiler.args '-O3', '-DNDEBUG'
			}
        }
    }
}

build.finalizedBy(deliverNewModelExec)
